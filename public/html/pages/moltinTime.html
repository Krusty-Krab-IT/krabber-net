{{define "title"}}Molts{{end}}

{{ define "page" }}
<!DOCTYPE html>
<html lang="en">
{{ template "header" .}}
<body class="bg-dark text-light">
    <div class="container-fluid vh-100 master-container">
        <div class="row h-100 justify-content-center">
        {{template "nav" .}}
         <!-- Main Content -->
        <div class="col col-lg-6 content border-dark border-left border-right p-0" id="main-panel">
            <div class="border-dark border-bottom-2" id="content-heading">
                <h6 class="m-1 absolute-container">
                     <strong>
                             Time to molt...
                     </strong>
                </h6>
                    {{if not .IsAuthenticated}}
                    <div class="alert alert-danger" role="alert">
                        Crab isn't logged in...
                    </div>
                   {{ end }}
                    <!-- The compose box lives here! -->
                    <div class="mini-compose-box border-bottom border-dark px-3 py-2 d-flex flex-row focused">
                        <div class="mini-molt-profile-box">
                            <a href="/crabs">
                                <div class="rounded-circle px43 profile-picture" style="background-image: url('../../static/img/crab_illustration.jpg');"></div>
                            </a>
                        </div>
                    <div class="mini-molt-text-box w-100 h-100 px-2">
                        <form hx-trigger="submit" hx-post="/molt/create" hx-on-htmx-after-request="if(event.detail.successful) this.reset()"  hx-target="#molt-list" hx-swap="afterbegin">
                            <input type='hidden' name='csrf_token' value='{{.CSRFToken}}'>
                            <div class="mini-compose-textarea">
                                <textarea id="content" name="content" rows="5" class="my-2 w-100" placeholder="How are you feeling?"></textarea>
                            </div>
                            <div class="mini-molt-actions d-flex flex-row justify-content-end w-100 compose-button-row">
                                <button type="submit" class="btn btn-primary rounded-pill"><strong>Molt</strong></button>
                            </div>
                        </form>
                        </div>
                    </div>
                    {{ if not .Molts }}
                    <div class="alert alert-info" role="alert">
                        You haven't molted anything or followed anyone yet. <a href="/seas" class="alert-link">Click
                            here</a> to explore.
                    </div>
                    {{ end }}

            </div>
            <div id="content-body" class="h-100">


             <ul id="molt-list">
                 {{ range .Molts  }}
                    {{block "molt-list-element" . }}
                       <div class="regular-molt mini-molt border-dark py-2 d-flex flex-row absolute-container border-bottom px-3">
                                <!-- Deleted or unavailable indicator -->
                                    <!-- Profile box -->
                                    <div class="mini-molt-profile-box">
                                        <!-- molt thread link -->
                                            <!-- Avatar image -->
                                            <img class="rounded-circle px43 profile-picture" src="../../static/img/crab_illustration.jpg">

                                    </div>

                                    <!-- Indicator box -->
                                    <div class="mini-molt-text-box w-100 h-100 px-2">
                                        <div class="mini-molt-credentials absolute-container">
                                                <div class="mini-molt-credentials-text">
                                                    <!-- Display name -->
            {{/*                                        <a class="mini-molt-display-name zindex-front" href="/user/namename">*/}}
            {{/*                                            namename*/}}
            {{/*                                        </a>*/}}
                                                    <span class="mini-molt-username zindex-front">
                                                        @{{ .Author }}
                                                    </span>

                                                    <!-- Molt age -->
                                                    <span class="mini-molt-timestamp zindex-front">
                                                        {{slice .GSI3PK 2 }}
                                                    </span>

                                                    <!-- Thread badge -->
                                                    <span class="text-muted">Â·</span>
                                                    <span class="thread-badge">
                                                        Thread
                                                    </span>
                                                </div>
                                            </div>
                                        <!-- Molt content -->
                                        <div class="mini-molt-content">
                                                    <p class="mb-2">
                                                        <span class="zindex-front clickable" >
                                                            {{ .Content }}
                                                        </span>
                                                    </p>
                                            </div>
                                        <div class="mini-molt-actions d-flex flex-row justify-content-between mr-md-5">
                                            <div class="mini-molt-action reply rounded-circle zindex-front" >
                                            <a href="/molt/view/{{.ID}}">
                                                <svg class="mini-molt-action-icon" width="19" height="19" data-jam="message">
                                                    <use href="/static/img/sprites.svg?version=1704178675#message"></use>
                                                </svg>
                                                <span class="mini-molt-action-counter ml-1">
                                                        {{ .CommentCount }}
                                                </span>
                                            </a>
                                            </div>

                                            <!-- Remolt dropdown -->
                                            <div class="dropdown">
                                                <!-- Remolt dropdown button -->
                                                <div class="zindex-front mini-molt-action remolt" href="#" role="button" id="dropdownMenuLink" aria-haspopup="true" aria-expanded="false">
                                                    <svg class="mini-molt-action-icon" width="19" height="19" data-jam="repeat">
                                                        <use href="/static/img/sprites.svg?version=1704178675#repeat"></use>
                                                    </svg>
                                                    <span class="mini-molt-action-counter ml-1">
                                                            {{ .RemoltCount }}
                                                    </span>
                                                </div>
                                            </div>

                                            <!-- Like button -->
                                            <form method="POST">
            {{/*                                    <input type='hidden' name='csrf_token' value='{{$out.CSRFToken}}'>*/}}
                                                <div class="mini-molt-action like zindex-front">
                                                    <!-- Fake like button (for welcome page showcase) -->

                                                        <svg class="mini-molt-action-icon" width="19" height="19" data-jam="heart">
                                                            <use href="/static/img/sprites.svg?version=1704178675#heart"></use>
                                                        </svg>

                                                        <svg class="mini-molt-action-icon text-primary d-none" width="19" height="19" data-jam="heart-f">
                                                            <use href="/static/img/sprites.svg?version=1704178675#heart-f"></use>
                                                        </svg>
                                                        <span class="mini-molt-action-counter ml-1">
                                                            {{ .LikeCount }}
                                                        </span>

                                                </div>
                                            </form>

                                                <!-- Dropdown button -->
                                            <div class="dropdown">
                                                <span class="zindex-front mini-molt-action reply" id="dropdownMenuLink" href="#" role="button" aria-haspopup="true" aria-expanded="false">


                                            <svg class="mini-molt-action-icon" width="19" height="19" data-jam="more-horizontal">
                                                <use href="/static/img/sprites.svg?version=1704178675#more-horizontal"></use>
                                            </svg>

                                                </span>


                                                    <div class="neue-card molt-dropdown dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                        <!-- Mod panel button -->



                                                    </div>
                                                 <!-- if current user -->
                                            </div>

                                        </div>
                                    </div>


                                 <!-- if deleted or unavailable -->
                            </div>
                   {{ end }}
                {{ end }}
              </ul>

                <!-- Spacer -->
                <div class="d-inline-block w-100 p-5 my-5 text-muted text-molt text-center"></div>

            </div>

        </div>
         <!-- Additional Panel -->
        {{ template "search" . }}
    </div>
   </div>
</body>
</html>
{{ end }}

                 {{ if not .Notifications }}
                    <div class="alert alert-info" role="alert">
                        Nothing to see here...
                    </div>
                 {{ end }}

                    {{ range .Notifications }}
                        {{ .PK }}
                        {{ .SK }}
                        {{ .TTL }}
                        {{ .Viewed }}
                    {{ end }}